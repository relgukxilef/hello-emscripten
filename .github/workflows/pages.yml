# Simple workflow for deploying static content to GitHub Pages
name: Deploy static content to Pages

on:
  # Runs on pushes targeting the default branch
  push:
    branches: ["main", "relgukxilef-patch-1"]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Allow one concurrent deployment
concurrency:
  group: "pages"
  cancel-in-progress: true

env:
  # Customize the CMake build type here (Release, Debug, RelWithDebInfo, etc.)
  BUILD_TYPE: Release
  CXX: em++ 
  CC: emcc

jobs:
  # Single deploy job since we're just deploying
  build-and-deploy:
    environment:
      name: github-pages
      url: ${{steps.deployment.outputs.page_url}}
    runs-on: ubuntu-latest
    container:
      image: emscripten/emsdk

    steps:
    - uses: actions/checkout@v3
    - run: cmake -B $GITHUB_WORKSPACE/build -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}} -DEMSCRIPTEN=ON
    - run: cmake --build $GITHUB_WORKSPACE/build --config ${{env.BUILD_TYPE}}

    # actions/upload-pages-artifact uses this directory, but it doesn't exist in the image
    - run: mkdir -p ${{runner.temp}}

    - uses: actions/configure-pages@v1
    - uses: actions/upload-pages-artifact@v1
      with:
        path: $GITHUB_WORKSPACE/build/source
    - id: deployment
      uses: actions/deploy-pages@v1  
